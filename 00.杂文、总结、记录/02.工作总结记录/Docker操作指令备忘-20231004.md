# Docker操作指令备忘

## 镜像打包
### 1. 查看Docker镜像
```shell
docker images
```

### 2. 本地构建镜像
注： 需要在Dockerfile文件所在目录执行指令
```shell
docker build --tag <name>

# 示例：
docker build --tag xwharbor.wxchina.com/cpaas-test/sedp-test/sedp-biz-server:NAT-IP-POC-V1.1 .
```

### 3. 从harbor仓库拉取镜像到本地
```shell
docker pull <name>

# 示例：
docker pull xwharbor.wxchina.com/cpaas-test/sedp-test/sedp-biz-server@sha256:a961eb0ecbf54b0d86aa12a827eb192d415ab33b2d00e6ca591eef82579fef02

docker pull xwharbor.wxchina.com/cpaas-test/sedp-test/sedp-biz-server:NAT-IP-switch-tool-786b59cf09b
```

### 4. 更改镜像标签
```shell
docker tag <old-name> <new-name>

# 示例：
docker tag xwharbor.wxchina.com/cpaas-test/sedp-test/sedp-biz-server:NAT-IP-switch-tool-786b59cf09b xwharbor.wxchina.com/cpaas-test/sedp-test/sedp-biz-server:NAT-IP-switch-tool-22222222
```

### 5. 推送镜像到harbor
```shell
docker push <name>

# 示例：
docker push xwharbor.wxchina.com/cpaas-test/sedp-test/sedp-biz-server:NAT-IP-switch-tool-22222222
```

### 6. 删除镜像缓存
```shell
docker rmi <your-image-id>

# 若一个镜像存在多个仓库
Error response from daemon: conflict: unable to delete d1aa18706bc3 (must be forced) - image is referenced in multiple repositories

# 可使用repository和tag的方式来删除
docker rmi <repository:tag>
```

## 镜像运行

### 1. 查看正在运行的镜像

```shell
docker ps -a [ | grep xxx ]
```

### 2. 停止运行中的镜像

```shell
docker stop [docker ID]
```

### 3. 删除容器

```shell
docker rm [docker ID]
```

### 4. 查看容器日志

```shell
$ docker logs [OPTIONS] CONTAINER
  Options:
        --details        显示更多的信息
    -f, --follow         跟踪实时日志
        --since string   显示自某个timestamp之后的日志，或相对时间，如42m（即42分钟）
        --tail string    从日志末尾显示多少行日志， 默认是all
    -t, --timestamps     显示时间戳
        --until string   显示自某个timestamp之前的日志，或相对时间，如42m（即42分钟）
```

```shell
docker -f --tail=100 [docker ID]
```